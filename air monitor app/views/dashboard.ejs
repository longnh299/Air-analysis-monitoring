<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
        body{
            background-color: #FFFAF0;
        }
        .topnav {
    background-color: #333;
    overflow: hidden;
}
.topnav-right {
  float: right;
}
.div2 {
    padding-top: 50px;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.0.0.min.js"></script>
<script src="socket.io/socket.io.js"></script>
<script src="jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="topnav-right">
        <a href="/users/logout">Đăng Xuất</a>
    </div>   
    <div class="div2">
        <p class="lead mb-3">Xin chào <%= %> , bạn hãy chọn trạm đo</p>
        <label>Trạm đo:</label>
        <select>
        <option value="hungyen">Hưng Yên</option>
        <option value="ninhbinh">Ninh Bình</option>
        </select>
        <p>Chúng tôi cung cấp thông tin về nồng độ các chất khí cho bạn như bảng dưới đây :</p>
        <table border="1" width="550">
            <tr align="center">
                <th>Tên Chất khí</th>
                <th>Nồng độ</th>
            </tr>
            <tr>
                <td align="center">CO2</td>
                <td align="center">402 ppm</td>
            </tr>
            <tr>
                <td align="center">CO</td>
                <td align="center">2.3 ppm</td>
            </tr>
            <tr>
                <td align="center">NH4</td>
                <td align="center" ><span id="nh4"></span> </td>
            </tr>
            <tr>
                <td align="center">Toluen</td>
                <td align="center">2.5 ppm</td>
            </tr>
        </table>
    </div>
    <!--Ve chart-->
    <div id="chart">
        <script>
            Plotly.newPlot('chart',[{
                    y:[],
                    type:'line',
                    line: {
                    color: 'rgb(128, 0, 128)',
                }
            }]);
            setInterval(function(){
                var socket = io("http://localhost:3000");
                var cnt = 0;
                socket.on('Server-sent-data', function(data){
                // return data;
                console.log(data)              
                
                Plotly.extendTraces('chart',{ y:[[data.items[11]]]}, [0]);
                $(document).ready(function(){
                    $("#nh4").text(data.items[11]);
                    });

                cnt++;
                if(cnt > 50) {
                    Plotly.relayout('chart',{
                        xaxis: {
                            range: [cnt-50,cnt]
                        }
                    }
                    );
                };
            })
            },2000);
        </script>
    </div>
</body>
</html>



