<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
        body{
            background-color: #FFFAF0;
        }
        .topnav {
    background-color: #333;
    overflow: hidden;
}
.topnav-right {
  float: right;
}
.div2 {
    padding-top: 50px;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.0.0.min.js"></script>
<script src="socket.io/socket.io.js"></script>
<!-- <script src="jquery-3.5.1.min.js"></script> -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>
<body>
    <div class="topnav-right">
        <a href="/users/logout">Đăng Xuất</a>
    </div>   
    <div class="div2">
        <p class="lead mb-3">Xin chào <%= %> , bạn hãy chọn trạm đo</p>
        <label>Trạm đo:</label>
        <select>
        <option value="hungyen">Ninh Bình</option>
        <option value="ninhbinh">Hưng Yên</option>
        </select>
        <p>Chúng tôi cung cấp thông tin về nồng độ các chất khí cho bạn như bảng dưới đây :</p>
        <table border="1" width="550">
            <tr align="center">
                <th>Tên Chất khí</th>
                <th>Nồng độ</th>
            </tr>
            <tr>
                <td align="center">CO2</td>
                <td align="center"><span id="co2"></span></td>
            </tr>
            <tr>
                <td align="center">CO</td>
                <td align="center"><span id="co"></span></td>
            </tr>
            <tr>
                <td align="center">NH4</td>
                <td align="center"><span id="nh4"></span></td>
            </tr>
            <tr>
                <td align="center">Tolueno</td>
                <td align="center"><span id="tolueno"></span></td>
            </tr>
        </table>
    </div>
    <!--Ve chart-->
    <div id="chart">
        <script>
            Plotly.newPlot('chart',[{
                    y:[],
                    type:'line',
                    line: {
                    color: 'rgb(128, 0, 128)',
                }
            }]);
            setInterval(function(){
                var socket = io("http://localhost:3000");
                var cnt = 0;
                socket.on('Server-sent-dataNH4', function(dataNH4){
                // return data;
                          
                
                Plotly.extendTraces('chart',{ y:[[dataNH4.items[11]]]}, [0]);
                $(document).ready(function(){
                    $("#nh4").text(dataNH4.items[11]);
                    });

                cnt++;
                if(cnt > 50) {
                    Plotly.relayout('chart',{
                        xaxis: {
                            range: [cnt-50,cnt]
                        }
                    }
                    );
                };
            })
            },2000);
        </script>
    </div>
    <div id='chart1'>
        <script>
            Plotly.newPlot('chart1',[{
                    y:[],
                    type:'line',
                    line: {
                    color: 'rgb(128, 0, 128)',
                }
            }]);
            setInterval(function(){
                var socket = io("http://localhost:3000");
                var cnt1 = 0;
                socket.on('Server-sent-dataCO', function(dataCO){
                // return data;
                         
                
                Plotly.extendTraces('chart1',{ y:[[dataCO.items[11]]]}, [0]);
                $(document).ready(function(){
                    $("#co").text(dataCO.items[11]);
                    });

                cnt1++;
                if(cnt1 > 50) {
                    Plotly.relayout('chart1',{
                        xaxis: {
                            range: [cnt1-50,cnt1]
                        }
                    }
                    );
                };
            })
            },2000);
        </script>
    </div>
    <div id='chart2'>
        <script>
            Plotly.newPlot('chart2',[{
                    y:[],
                    type:'line',
                    line: {
                    color: 'rgb(128, 0, 128)',
                }
            }]);
            setInterval(function(){
                var socket = io("http://localhost:3000");
                var cnt2 = 0;
                socket.on('Server-sent-dataCO2', function(dataCO2){
                // return data;
                            
                
                Plotly.extendTraces('chart2',{ y:[[dataCO2.items[11]]]}, [0]);
                $(document).ready(function(){
                    $("#co2").text(dataCO2.items[11]);
                    });

                cnt2++;
                if(cnt2 > 50) {
                    Plotly.relayout('chart2',{
                        xaxis: {
                            range: [cnt2-50,cnt2]
                        }
                    }
                    );
                };
            })
            },2000);
        </script>
    </div>
   <div id='chart3'>
        <script>
            Plotly.newPlot('chart3',[{
                    y:[],
                    type:'line',
                    line: {
                    color: 'rgb(128, 0, 128)',
                }
            }]);
            setInterval(function(){
                var socket = io("http://localhost:3000");
                var cnt3 = 0;
                socket.on('Server-sent-dataTolueno', function(dataTolueno){
                // return data;
                 console.log(dataTolueno[11]);           
                
                Plotly.extendTraces('chart3',{ y:[[dataTolueno.items[11]]]}, [0]);
                $(document).ready(function(){
                    $("#tolueno").text(dataTolueno.items[11]);
                    });

                cnt3++;
                if(cnt3 > 50) {
                    Plotly.relayout('chart3',{
                        xaxis: {
                            range: [cnt3-50,cnt3]
                        }
                    }
                    );
                };
            })
            },2000);
        </script>
    </div>
</body>
</html>



